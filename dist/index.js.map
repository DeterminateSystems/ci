{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import * as actionsCore from \"@actions/core\";\nimport * as actionsExec from \"@actions/exec\";\nimport { DetSysAction } from \"detsys-ts\";\n\nconst EVENT_EXECUTION_FAILURE = \"execution_failure\";\n\nclass DeterminateCi extends DetSysAction {\n  constructor() {\n    super({\n      name: \"flake-iter\",\n      fetchStyle: \"gh-env-style\",\n      diagnosticsSuffix: \"telemetry\",\n      requireNix: \"fail\",\n    });\n  }\n\n  async main(): Promise<void> {\n    const binaryPath = await this.fetchExecutable();\n\n    const exitCode = await actionsExec.exec(binaryPath, [], {\n      // To get $FLAKE_ITER_RUNNER_MAP or $FLAKE_ITER_NIX_SYSTEM (depending on workflow step)\n      env: process.env as Record<string, string>,\n      ignoreReturnCode: true,\n    });\n\n    if (exitCode !== 0) {\n      this.recordEvent(EVENT_EXECUTION_FAILURE, {\n        exitCode,\n      });\n      actionsCore.setFailed(`Non-zero exit code of \\`${exitCode}\\`.`);\n    }\n  }\n\n  // No post step\n  async post(): Promise<void> {}\n}\n\nfunction main(): void {\n  new DeterminateCi().execute();\n}\n\nmain();\n"],"mappings":";AAAA,YAAY,iBAAiB;AAC7B,YAAY,iBAAiB;AAC7B,SAAS,oBAAoB;AAE7B,IAAM,0BAA0B;AAEhC,IAAM,gBAAN,cAA4B,aAAa;AAAA,EACvC,cAAc;AACZ,UAAM;AAAA,MACJ,MAAM;AAAA,MACN,YAAY;AAAA,MACZ,mBAAmB;AAAA,MACnB,YAAY;AAAA,IACd,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,OAAsB;AAC1B,UAAM,aAAa,MAAM,KAAK,gBAAgB;AAE9C,UAAM,WAAW,MAAkB,iBAAK,YAAY,CAAC,GAAG;AAAA;AAAA,MAEtD,KAAK,QAAQ;AAAA,MACb,kBAAkB;AAAA,IACpB,CAAC;AAED,QAAI,aAAa,GAAG;AAClB,WAAK,YAAY,yBAAyB;AAAA,QACxC;AAAA,MACF,CAAC;AACD,MAAY,sBAAU,2BAA2B,QAAQ,KAAK;AAAA,IAChE;AAAA,EACF;AAAA;AAAA,EAGA,MAAM,OAAsB;AAAA,EAAC;AAC/B;AAEA,SAAS,OAAa;AACpB,MAAI,cAAc,EAAE,QAAQ;AAC9B;AAEA,KAAK;","names":[]}