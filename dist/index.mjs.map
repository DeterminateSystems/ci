{"version":3,"file":"index.mjs","names":[],"sources":["../src/index.ts"],"sourcesContent":["import * as actionsCore from \"@actions/core\";\nimport * as actionsExec from \"@actions/exec\";\nimport { DetSysAction } from \"detsys-ts\";\n\nconst EVENT_EXECUTION_FAILURE = \"execution_failure\";\n\nclass DeterminateCi extends DetSysAction {\n  constructor() {\n    super({\n      name: \"flake-iter\",\n      fetchStyle: \"gh-env-style\",\n      diagnosticsSuffix: \"telemetry\",\n      requireNix: \"fail\",\n    });\n  }\n\n  async main(): Promise<void> {\n    const binaryPath = await this.fetchExecutable();\n\n    const exitCode = await actionsExec.exec(binaryPath, [], {\n      env: {\n        ...process.env, // To get $FLAKE_ITER_RUNNER_MAP or $FLAKE_ITER_NIX_SYSTEM (depending on workflow step)\n      },\n      ignoreReturnCode: true,\n    });\n\n    if (exitCode !== 0) {\n      this.recordEvent(EVENT_EXECUTION_FAILURE, {\n        exitCode,\n      });\n      actionsCore.setFailed(`Non-zero exit code of \\`${exitCode}\\`.`);\n    }\n  }\n\n  // No post step\n  async post(): Promise<void> {}\n}\n\nfunction main(): void {\n  new DeterminateCi().execute();\n}\n\nmain();\n"],"mappings":";;;;;AAIA,MAAM,0BAA0B;AAEhC,IAAM,gBAAN,cAA4B,aAAa;CACvC,cAAc;AACZ,QAAM;GACJ,MAAM;GACN,YAAY;GACZ,mBAAmB;GACnB,YAAY;GACb,CAAC;;CAGJ,MAAM,OAAsB;EAC1B,MAAM,aAAa,MAAM,KAAK,iBAAiB;EAE/C,MAAM,WAAW,MAAM,YAAY,KAAK,YAAY,EAAE,EAAE;GACtD,KAAK,EACH,GAAG,QAAQ,KACZ;GACD,kBAAkB;GACnB,CAAC;AAEF,MAAI,aAAa,GAAG;AAClB,QAAK,YAAY,yBAAyB,EACxC,UACD,CAAC;AACF,eAAY,UAAU,2BAA2B,SAAS,KAAK;;;CAKnE,MAAM,OAAsB;;AAG9B,SAAS,OAAa;AACpB,KAAI,eAAe,CAAC,SAAS;;AAG/B,MAAM"}